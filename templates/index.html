<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>√öltima Lectura</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f8f8f8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #eee;
    }
    .btn {
      margin-top: 20px;
      padding: 10px 15px;
      background-color: #007BFF;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>üìà √öltima Lectura Registrada</h1>
  <button class="btn" onclick="descargarCSV()">‚¨áÔ∏è Descargar CSV y Vaciar</button>
  <table id="tabla">
    <thead>
      <tr id="headers"></tr>
    </thead>
    <tbody>
      <tr id="fila"></tr>
    </tbody>
  </table>
  <p id="mensaje" style="margin-top: 20px; color: gray;"></p>

  <script>
    async function cargarUltimoDato() {
      try {
        const res = await fetch("/api/ultimo");
        const data = await res.json();

        if (!data || Object.keys(data).length === 0) {
          document.getElementById("mensaje").textContent = "‚è≥ A√∫n no hay datos.";
          return;
        }

        const headers = Object.keys(data);
        const values = Object.values(data);

        if (document.getElementById("headers").children.length === 0) {
          document.getElementById("headers").innerHTML =
            headers.map(h => `<th>${h}</th>`).join("");
        }

        document.getElementById("fila").innerHTML =
          values.map(v => `<td>${v}</td>`).join("");

        document.getElementById("mensaje").textContent = "";

      } catch (error) {
        document.getElementById("mensaje").textContent =
          "‚ö†Ô∏è Error al obtener datos.";
        console.error("Error:", error);
      }
    }

    function descargarCSV() {
      window.location.href = "/descargar_csv";
      setTimeout(() => location.reload(), 3000);
    }

    cargarUltimoDato();
    setInterval(cargarUltimoDato, 5000);
  </script>
</body>
</html>
